import{d as t,C as e,g as n}from"./main-Dc76bcfD.js";import{q as s,c as a,b as i,w as o,u as d,d as r,e as c}from"./vendor-FisM0nxI.js";import"./bootstrap-BAiwbtED.js";/* empty css                    */import"./utils-C620QYE8.js";import"./components-QOneMgCI.js";class l{constructor(){this.isAuthenticated=!1,this.adminKey="your_secure_production_admin_key_here_2024",this.sessionTimeout=18e5,this.maxLoginAttempts="5",this.loginAttempts=0,this.comments=[],this.reports=[],this.unsubscribes=[],this.stats={total:0,pending:0,approved:0,rejected:0,reports:0},this.init()}init(){this.setupEventListeners(),this.checkExistingAuth()}checkExistingAuth(){const t=sessionStorage.getItem("admin_authenticated"),e=sessionStorage.getItem("admin_login_time");if("true"===t&&e){const t=Date.now()-parseInt(e);t<this.sessionTimeout?(this.isAuthenticated=!0,this.showDashboard(),this.loadDashboardData(),this.setSessionTimeout(this.sessionTimeout-t)):(this.clearAuthSession(),this.showNotification("Session expired. Please login again.","warning"))}}setupEventListeners(){const t=document.getElementById("adminLoginForm");t&&t.addEventListener("submit",t=>{t.preventDefault(),this.handleLogin()});const e=document.getElementById("togglePassword");e&&e.addEventListener("click",()=>{const t=document.getElementById("adminKey"),n=e.querySelector("i");"password"===t.type?(t.type="text",n.classList.replace("fa-eye","fa-eye-slash")):(t.type="password",n.classList.replace("fa-eye-slash","fa-eye"))});const n=document.getElementById("logoutBtn");n&&n.addEventListener("click",()=>{this.handleLogout()});const s=document.getElementById("approvalThreshold");if(s){const t="80";s.value=t,document.getElementById("approvalValue").textContent=t,s.addEventListener("input",t=>{document.getElementById("approvalValue").textContent=t.target.value})}const a=document.getElementById("rejectionThreshold");if(a){const t="40";a.value=t,document.getElementById("rejectionValue").textContent=t,a.addEventListener("input",t=>{document.getElementById("rejectionValue").textContent=t.target.value})}const i=document.getElementById("refreshComments");i&&i.addEventListener("click",()=>{this.loadAllComments()});const o=document.getElementById("statusFilter");o&&o.addEventListener("change",()=>{this.filterComments()}),document.addEventListener("click",t=>{const e=t.target.closest('button[data-bs-toggle="tab"]');e&&setTimeout(()=>{"pending-tab"===e.id?this.loadPendingComments():"reports-tab"===e.id?this.loadUserReports():"all-comments-tab"===e.id&&this.loadAllComments()},50)}),document.addEventListener("shown.bs.tab",t=>{const e=t.target.id;"all-comments-tab"===e?this.loadAllComments():"pending-tab"===e?this.loadPendingComments():"reports-tab"===e&&this.loadUserReports()})}handleLogin(){const t=document.getElementById("adminKey"),e=document.getElementById("authError");if(this.loginAttempts>=this.maxLoginAttempts)return e.innerHTML='\n        <i class="fas fa-exclamation-triangle me-2"></i>\n        Too many failed attempts. Please refresh the page to try again.\n      ',e.style.display="block",void(t.disabled=!0);if(t.value===this.adminKey)this.isAuthenticated=!0,this.loginAttempts=0,sessionStorage.setItem("admin_authenticated","true"),sessionStorage.setItem("admin_login_time",Date.now().toString()),e.style.display="none",t.disabled=!1,this.showDashboard(),this.loadDashboardData(),this.setSessionTimeout(this.sessionTimeout),this.showNotification("Welcome to Admin Panel (production)","success");else{this.loginAttempts++;const n=this.maxLoginAttempts-this.loginAttempts;e.innerHTML=`\n        <i class="fas fa-exclamation-triangle me-2"></i>\n        Invalid admin key. ${n} attempts remaining.\n      `,e.style.display="block",t.value="",t.focus()}}handleLogout(){this.isAuthenticated=!1,this.clearAuthSession(),this.unsubscribes.forEach(t=>t()),this.unsubscribes=[],this.sessionTimeoutId&&clearTimeout(this.sessionTimeoutId),this.showAuthForm(),this.showNotification("Logged out successfully","info")}clearAuthSession(){sessionStorage.removeItem("admin_authenticated"),sessionStorage.removeItem("admin_login_time"),this.loginAttempts=0;const t=document.getElementById("adminKey");t&&(t.disabled=!1)}setSessionTimeout(t){this.sessionTimeoutId&&clearTimeout(this.sessionTimeoutId),this.sessionTimeoutId=setTimeout(()=>{this.showNotification("Session expired due to inactivity","warning"),this.handleLogout()},t)}showDashboard(){document.getElementById("adminAuth").style.display="none",document.getElementById("adminDashboard").style.display="block",setTimeout(()=>{this.initializeTabs()},100)}initializeTabs(){if(void 0===window.bootstrap)return void this.initializeFallbackTabs();document.querySelectorAll('#adminTabs button[data-bs-toggle="tab"]').forEach(t=>{const e=new window.bootstrap.Tab(t);t.addEventListener("click",n=>{n.preventDefault(),e.show(),setTimeout(()=>{this.handleTabSwitch(t.id)},50)})})}initializeFallbackTabs(){const t=document.querySelectorAll('#adminTabs button[data-bs-toggle="tab"]'),e=document.querySelectorAll(".tab-pane");t.forEach(n=>{n.addEventListener("click",s=>{s.preventDefault(),t.forEach(t=>t.classList.remove("active")),e.forEach(t=>{t.classList.remove("show","active")}),n.classList.add("active");const a=n.getAttribute("data-bs-target"),i=document.querySelector(a);i&&i.classList.add("show","active"),setTimeout(()=>{this.handleTabSwitch(n.id)},50)})})}handleTabSwitch(t){switch(t){case"pending-tab":this.loadPendingComments();break;case"reports-tab":this.loadUserReports();break;case"all-comments-tab":this.loadAllComments();break;case"settings-tab":this.updateSystemStatus()}}showAuthForm(){document.getElementById("adminAuth").style.display="flex",document.getElementById("adminDashboard").style.display="none"}async loadDashboardData(){await this.loadStats(),await this.loadPendingComments(),setTimeout(()=>{this.loadAllComments()},200),this.updateSystemStatus()}async loadStats(){try{const n=s(a(t,e.COMMENTS)),o=await i(n);this.stats={total:0,pending:0,approved:0,rejected:0,reports:0},o.forEach(t=>{const e=t.data();switch(this.stats.total++,e.status){case"pending_review":this.stats.pending++;break;case"approved":default:this.stats.approved++;break;case"rejected":this.stats.rejected++}});const d=s(a(t,"reports")),r=await i(d);this.stats.reports=r.size,this.updateStatsDisplay()}catch(n){this.showNotification("Failed to load statistics","error")}}updateStatsDisplay(){document.getElementById("totalCommentsCount").textContent=this.stats.total,document.getElementById("pendingCount").textContent=this.stats.pending,document.getElementById("approvedCount").textContent=this.stats.approved,document.getElementById("reportsCount").textContent=this.stats.reports,document.getElementById("pendingBadge").textContent=this.stats.pending,document.getElementById("reportsBadge").textContent=this.stats.reports}async loadPendingComments(){try{const n=s(a(t,e.COMMENTS),o("status","==","pending_review")),d=await i(n),r=[];d.forEach(t=>{r.push({id:t.id,...t.data()})}),r.sort((t,e)=>{const n=t.createdAt?.toDate?.()||new Date(0);return(e.createdAt?.toDate?.()||new Date(0))-n}),this.renderPendingComments(r)}catch(n){this.showNotification("Failed to load pending comments","error")}}renderPendingComments(t){const e=document.getElementById("pendingComments");0!==t.length?(e.innerHTML=t.map(t=>this.renderModerationCard(t,"pending")).join(""),t.forEach(t=>{this.attachModerationListeners(t.id)})):e.innerHTML='\n        <div class="text-center text-muted py-4">\n          <i class="fas fa-inbox fa-3x mb-3"></i>\n          <p>No comments pending review</p>\n        </div>\n      '}renderModerationCard(t,e){const n=t.moderation||{},s=t.createdAt?.toDate?.()?.toLocaleDateString()||(new Date).toLocaleDateString();return`\n      <div class="card bg-dark border-secondary mb-3" data-comment-id="${t.id}">\n        <div class="card-body">\n          <div class="row">\n            <div class="col-md-8">\n              <div class="d-flex justify-content-between align-items-start mb-2">\n                <div>\n                  <strong class="text-warning">${this.escapeHtml(t.playerName)}</strong>\n                  <div class="rating-display mt-1">\n                    ${"★".repeat(t.rating)}${"☆".repeat(5-t.rating)}\n                    <small class="text-muted ms-2">${t.rating}/5</small>\n                  </div>\n                </div>\n                <small class="text-muted">${s}</small>\n              </div>\n              \n              <p class="text-light mb-2">"${this.escapeHtml(t.commentText||t.comment)}"</p>\n              \n              ${t.favoriteAspect?`\n                <div class="mb-2">\n                  <span class="badge bg-info">${t.favoriteAspect}</span>\n                </div>\n              `:""}\n            </div>\n            \n            <div class="col-md-4">\n              <div class="mb-3">\n                <h6 class="text-light">Moderation Score</h6>\n                <div class="d-flex gap-2 flex-wrap mb-2">\n                  <span class="badge bg-${this.getSeverityColor(n.severity)}">\n                    Score: ${n.score||"N/A"}\n                  </span>\n                  <span class="badge bg-secondary">${n.severity||"unknown"}</span>\n                </div>\n                \n                ${n.flags?.length?`\n                  <div class="mb-2">\n                    ${n.flags.map(t=>`<span class="badge bg-info">${t}</span>`).join(" ")}\n                  </div>\n                `:""}\n                \n                ${n.issues?.length?`\n                  <div class="mb-2">\n                    <small class="text-danger">Issues: ${n.issues.join(", ")}</small>\n                  </div>\n                `:""}\n              </div>\n              \n              <div class="d-grid gap-2">\n                ${"pending"===e?`\n                  <button class="btn btn-success btn-sm approve-btn" data-comment-id="${t.id}">\n                    <i class="fas fa-check me-1"></i> Approve\n                  </button>\n                  <button class="btn btn-warning btn-sm reject-btn" data-comment-id="${t.id}">\n                    <i class="fas fa-times me-1"></i> Reject\n                  </button>\n                `:""}\n                <button class="btn btn-danger btn-sm delete-btn" data-comment-id="${t.id}">\n                  <i class="fas fa-trash me-1"></i> Delete\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    `}getSeverityColor(t){switch(t){case"severe":return"danger";case"moderate":return"warning";case"mild":return"info";case"clean":return"success";default:return"secondary"}}attachModerationListeners(t){const e=document.querySelector(`.approve-btn[data-comment-id="${t}"]`),n=document.querySelector(`.reject-btn[data-comment-id="${t}"]`),s=document.querySelector(`.delete-btn[data-comment-id="${t}"]`);e&&e.addEventListener("click",()=>this.approveComment(t)),n&&n.addEventListener("click",()=>this.rejectComment(t)),s&&s.addEventListener("click",()=>this.deleteComment(t))}async approveComment(n){try{await d(r(t,e.COMMENTS,n),{status:"approved","moderation.approved":!0,"moderation.reviewedAt":(new Date).toISOString(),"moderation.reviewedBy":"admin"}),this.showNotification("Comment approved successfully","success"),this.loadPendingComments(),this.loadAllComments(),this.loadStats()}catch(s){this.showNotification("Failed to approve comment","error")}}async rejectComment(n){try{await d(r(t,e.COMMENTS,n),{status:"rejected","moderation.approved":!1,"moderation.reviewedAt":(new Date).toISOString(),"moderation.reviewedBy":"admin"}),this.showNotification("Comment rejected successfully","success"),this.loadPendingComments(),this.loadAllComments(),this.loadStats()}catch(s){this.showNotification("Failed to reject comment","error")}}async deleteComment(n){if(confirm("Are you sure you want to permanently delete this comment?"))try{await c(r(t,e.COMMENTS,n)),this.showNotification("Comment deleted successfully","success"),this.loadPendingComments(),this.loadAllComments(),this.loadStats()}catch(s){this.showNotification("Failed to delete comment","error")}}async loadUserReports(){try{const e=s(a(t,"reports")),n=await i(e),o=[];n.forEach(t=>{o.push({id:t.id,...t.data()})}),o.sort((t,e)=>{const n=t.reportedAt?.toDate?.()||new Date(0);return(e.reportedAt?.toDate?.()||new Date(0))-n}),this.renderUserReports(o)}catch(e){this.showNotification("Failed to load user reports","error")}}renderUserReports(t){const e=document.getElementById("userReports");0!==t.length?e.innerHTML=t.map(t=>`\n      <div class="card bg-dark border-secondary mb-3">\n        <div class="card-body">\n          <div class="d-flex justify-content-between align-items-start mb-2">\n            <h6 class="text-warning">Report: ${t.reason}</h6>\n            <small class="text-muted">${t.reportedAt?.toDate?.()?.toLocaleDateString()}</small>\n          </div>\n          <p class="text-light">Comment ID: <code>${t.commentId}</code></p>\n          ${t.details?`<p class="text-muted">"${this.escapeHtml(t.details)}"</p>`:""}\n          <div class="d-flex gap-2">\n            <button class="btn btn-sm btn-primary resolve-report-btn" data-report-id="${t.id}">\n              <i class="fas fa-check me-1"></i> Resolve\n            </button>\n            <button class="btn btn-sm btn-outline-info view-comment-btn" data-comment-id="${t.commentId}">\n              <i class="fas fa-eye me-1"></i> View Comment\n            </button>\n          </div>\n        </div>\n      </div>\n    `).join(""):e.innerHTML='\n        <div class="text-center text-muted py-4">\n          <i class="fas fa-shield-check fa-3x mb-3"></i>\n          <p>No reports to review</p>\n        </div>\n      '}async loadAllComments(){try{const n=s(a(t,e.COMMENTS)),o=await i(n),d=[];if(o.forEach(t=>{d.push({id:t.id,...t.data()})}),d.sort((t,e)=>{const n=t.createdAt?.toDate?.()||new Date(0);return(e.createdAt?.toDate?.()||new Date(0))-n}),this.allComments=d,0===d.length){const t=document.getElementById("allComments");return void(t&&(t.innerHTML='\n            <div class="text-center text-muted py-4">\n              <i class="fas fa-comments fa-3x mb-3"></i>\n              <p>No comments found</p>\n              <small class="text-muted">Comments will appear here once users start leaving feedback</small>\n            </div>\n          '))}this.filterComments()}catch(n){this.showNotification("Failed to load comments: "+n.message,"error");const t=document.getElementById("allComments");t&&(t.innerHTML=`\n          <div class="text-center text-danger py-4">\n            <i class="fas fa-exclamation-triangle fa-3x mb-3"></i>\n            <p>Failed to load comments</p>\n            <small>${n.message}</small>\n          </div>\n        `)}}filterComments(){const t=document.getElementById("statusFilter"),e=t?.value||"all";let n=this.allComments||[];"all"!==e&&(n=n.filter(t=>t.status===e)),this.renderAllComments(n)}renderAllComments(t){const e=document.getElementById("allComments");if(e){if(0===t.length){const t=this.allComments?.length||0;return void(e.innerHTML=`\n        <div class="text-center text-muted py-4">\n          <i class="fas fa-comments fa-3x mb-3"></i>\n          <p>${0===t?"No comments found":"No comments match the selected filter"}</p>\n          <small class="text-muted">${0===t?"Comments will appear here once users start leaving feedback":`Total comments loaded: ${t}`}</small>\n        </div>\n      `)}e.innerHTML=t.map(t=>this.renderModerationCard(t,"all")).join(""),t.forEach(t=>{this.attachModerationListeners(t.id)})}}updateSystemStatus(){const t=n();document.getElementById("firebaseStatus").textContent=t.isInitialized?"Connected":"Disconnected",document.getElementById("firebaseStatus").className="badge bg-"+(t.isInitialized?"success":"danger"),document.getElementById("moderationStatus").textContent="Active",document.getElementById("lastUpdated").textContent=(new Date).toLocaleTimeString();const e=document.createElement("div");e.innerHTML='\n      <div class="mt-3 pt-3 border-top border-secondary">\n        <h6 class="text-light">Environment Info</h6>\n        <div class="mb-2">\n          <div class="d-flex justify-content-between">\n            <span class="text-light">Environment:</span>\n            <span class="badge bg-success">production</span>\n          </div>\n        </div>\n        <div class="mb-2">\n          <div class="d-flex justify-content-between">\n            <span class="text-light">App Version:</span>\n            <span class="text-muted">1.0.0</span>\n          </div>\n        </div>\n        <div class="mb-2">\n          <div class="d-flex justify-content-between">\n            <span class="text-light">Auto-Approval:</span>\n            <span class="text-muted">80+ points</span>\n          </div>\n        </div>\n        <div class="mb-2">\n          <div class="d-flex justify-content-between">\n            <span class="text-light">Auto-Rejection:</span>\n            <span class="text-muted">40- points</span>\n          </div>\n        </div>\n        <div class="mb-2">\n          <div class="d-flex justify-content-between">\n            <span class="text-light">Rate Limit:</span>\n            <span class="text-muted">3/hour</span>\n          </div>\n        </div>\n      </div>\n    ';const s=document.querySelector("#settings .card:last-child .card-body");s&&!s.querySelector(".border-top")&&s.appendChild(e)}showNotification(t,e="info"){const n=document.querySelector(".admin-notification");n&&n.remove();const s=document.createElement("div");s.className="admin-notification",s.innerHTML=`\n      <div style="\n        position: fixed;\n        top: 20px;\n        right: 20px;\n        background: ${"success"===e?"#28a745":"error"===e?"#dc3545":"#007bff"};\n        color: white;\n        padding: 1rem 1.5rem;\n        border-radius: 8px;\n        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n        z-index: 10000;\n        max-width: 300px;\n      ">\n        <i class="fas fa-${"success"===e?"check-circle":"error"===e?"exclamation-triangle":"info-circle"} me-2"></i>\n        ${t}\n      </div>\n    `,document.body.appendChild(s),setTimeout(()=>{s.parentNode&&s.remove()},4e3)}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}destroy(){this.unsubscribes.forEach(t=>t()),sessionStorage.removeItem("admin_authenticated")}}function m(){return new l}export{l as AdminSystem,m as initAdminPage};
